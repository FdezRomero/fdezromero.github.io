<!DOCTYPE html>
<html><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" version="2.0"><channel><title>Angular - Rodrigo Fernández</title><description>Full-stack Javascript, Ionic and Startups</description><link>http://fdezromero.com/</link><image><url>http://fdezromero.com/favicon.png</url><title>Angular - Rodrigo Fernández</title><link>http://fdezromero.com/</link></image><generator>Ghost 2.6</generator><lastBuildDate>Sun, 18 Nov 2018 18:35:44 GMT</lastBuildDate><atom:link href="http://fdezromero.com/tag/angular/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title>Injecting Providers into Async Custom Validators in Angular</title><description>One of the first things developers do when we are building a new app is a signup form, that checks that every field is okay and shows an appropriate error message if it’s not.</description><link>http://fdezromero.com/injecting-providers-into-async-custom-validators-in-angular/</link><guid isPermaLink="false">5bf18fcaae310cb196c77254</guid><category>Angular</category><category>Ionic</category><dc:creator>Rodrigo Fernández</dc:creator><pubDate>Fri, 09 Feb 2018 11:00:00 GMT</pubDate><media:content url="http://fdezromero.com/content/images/2018/11/jantine-doornbos-398339-unsplash.jpg" medium="image"/><content:encoded>&lt;img src="http://fdezromero.com/content/images/2018/11/jantine-doornbos-398339-unsplash.jpg" alt="Injecting Providers into Async Custom Validators in Angular"&gt;&lt;p&gt;One of the first things developers do when we are building a new app is a signup form, that checks that every field is okay and shows an appropriate error message if it’s not.&lt;/p&gt;&lt;p&gt;It’s also a common practice to check if the typed email is already registered or if the username is taken. Angular has some basic validators built in, but in order to check our API and return the status we need to write a custom async validator. Please read this great guide about &lt;a href="https://www.joshmorony.com/advanced-forms-validation-in-ionic-2/" rel="noopener"&gt;Advanced Forms &amp;amp; Validation in Ionic 2&lt;/a&gt; by Josh Morony first.&lt;/p&gt;&lt;p&gt;The only part missing in the guide is to actually inject the provider in charge of connecting to our API and getting the result. This is a bit tricky since async validators need to have static properties and we can’t inject a provider directly, so we will have to pass it to the validator class by using its constructor. This will work from Angular 2 onwards, I’m using Ionic 2.&lt;/p&gt;&lt;p&gt;Here is how I solved it. If you know any way to improve this code, please leave a comment with a link to your code!&lt;/p&gt;&lt;pre&gt;&lt;code class="language-ts"&gt;import { FormControl } from '@angular/forms';
import { UserService } from '../../providers/user-service/user-service';

export class UserValidator {
  static userService: UserService;
  static EMAIL_REGEXP = /.+@.+\..+/;

  constructor(userService: UserService) {
    UserValidator.userService = userService;
  }

  // Async validator: `new UserValidator(userService).checkEmailAvailable`

  checkEmailAvailable(input: FormControl) {
    if (!input.value || !UserValidator.EMAIL_REGEXP.test(input.value)) {
      return Promise.resolve({ invalid: true });
    }

    return UserValidator.userService.checkEmail(input.value)
    .then(data =&amp;gt; data &amp;amp;&amp;amp; data.available ? null : data)
    .catch(err =&amp;gt; console.error(err));
  }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;br&gt;We start making our class properties static, then we inject the provider UserService into the constructor. Because we have defined &lt;code&gt;userService&lt;/code&gt; as static, we can assign the reference to the provider by using the Class.property syntax.&lt;/p&gt;&lt;p&gt;The validator function is actually very simple: it returns &lt;code&gt;null&lt;/code&gt; if there aren’t any errors, or an object with every error set to true. My API actually returns &lt;code&gt;{ available: true }&lt;/code&gt; if everything is okay and then I convert that to null, but you may handle this differently.&lt;/p&gt;&lt;p&gt;Now every time we want to use this validator, we need to call it from our parent class like &lt;code&gt;new UserValidator(userService).checkEmailAvailable&lt;/code&gt; .&lt;/p&gt;&lt;p&gt;With this snippet, it would be fairly simple to create another validator function inside the &lt;code&gt;UserValidator&lt;/code&gt; class to check if a username is taken or not.&lt;/p&gt;</content:encoded></item></channel></rss></html>