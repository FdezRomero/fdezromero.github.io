<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0" xmlns:media="http://search.yahoo.com/mrss/"><channel><title><![CDATA[Rodrigo Fern√°ndez]]></title><description><![CDATA[Full-stack Javascript, Ionic & Startups]]></description><link>https://fdezromero.com/</link><image><url>https://fdezromero.com/favicon.png</url><title>Rodrigo Fern√°ndez</title><link>https://fdezromero.com/</link></image><generator>Ghost 2.6</generator><lastBuildDate>Tue, 20 Nov 2018 18:17:22 GMT</lastBuildDate><atom:link href="https://fdezromero.com/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title><![CDATA[How I Host this Static Ghost Blog on Github Pages with wget]]></title><description><![CDATA[Generating a static site from a local Ghost blog with wget instead of Buster and hosting it at GitHub Pages.]]></description><link>https://fdezromero.com/how-i-host-this-static-ghost-blog-on-github-pages-with-wget/</link><guid isPermaLink="false">5bf2dae9d5546074beaea791</guid><category><![CDATA[Web]]></category><dc:creator><![CDATA[Rodrigo Fern√°ndez]]></dc:creator><pubDate>Mon, 19 Nov 2018 17:19:17 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1508780709619-79562169bc64?ixlib=rb-0.3.5&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=1080&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ&amp;s=89d7af25dada5ebfb09405ae87cf372f" medium="image"/><content:encoded><![CDATA[<img src="https://images.unsplash.com/photo-1508780709619-79562169bc64?ixlib=rb-0.3.5&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=1080&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ&s=89d7af25dada5ebfb09405ae87cf372f" alt="How I Host this Static Ghost Blog on Github Pages with wget"><p>Lately I've been wanting to go back to writing more on my personal blog, so I'm currently in the process of gathering articles, slides, videos and code samples I wrote on various platforms.</p><p>Initially I wanted to write articles and pages in Markdown, generate some static blog pages from them, push to a repository, and host them in GitHub Pages. I tried several approaches, including building my blog off the <a href="https://github.com/ionic-team/stencil-site">great Stencil site generator</a>. But then decided that I didn't want to deal too much with templates and design, or I would spend more time coding and I'd never get to writing üòô</p><p>Coming from Medium, I liked Ghost's design and simplicity the most. Keeping another Node.js server with NGNIX and MySQL, backups and so on, not so much üòÖ. I found some middle ground installing Ghost locally (with the database in a SQLite file I can commit to a repo) and generating a static site with all the articles and pages.</p><p>I found many how-to's using Buster, a Python tool that automates the process of grabbing every page generating the site. The problem is that I soon noticed that the tool is no longer maintained and many things have changed in Ghost after it was last updated, so the result is essentially broken. I spent the rest of the day trying all the other forks with different results: some fixed some things and others fixed some other things. Either links were still pointing to localhost or pages were missing.</p><p>Then I remembered that the fantastic <code>wget</code> command has some backup and mirroring features, which Buster were also using under the hood. So I wrote a very simple bash script to automate the static generation process.</p><p>Here are the steps I followed to set up this blog. If you have a local Ghost installation, you can skip ahead to the script.</p><hr><h3 id="installing-ghost-locally">Installing Ghost locally</h3><p>To <a href="https://docs.ghost.org/install/local/">install Ghost locally</a> you will need the following:</p><ul><li>A supported version of <strong>Node.js</strong></li><li><strong>npm</strong> or <strong>yarn</strong> to manage packages</li><li>A clean, empty directory on your machine</li></ul><p>Ghost has a nice CLI tool we can install globally to handle multiple blogs:</p><pre><code class="language-bash">npm install -g ghost-cli
</code></pre>
<p>Then we need to create the empty directory were we want to store the blog, <code>cd</code> into it and run the local install command:</p><pre><code class="language-bash">ghost install local
</code></pre>
<p>After that, the blog will be installed in this directory and served at <code>https://fdezromero.com</code>, if you don't have previous Ghost installations. The admin is accessible from <code>https://fdezromero.com/ghost</code>.</p><p>The database file is located at <code>content/data</code>, in case you want to keep a backup in a private repo.</p><h3 id="generating-the-static-site">Generating the static site</h3><p>Once we have set up our Ghost blog, edited our user, created some articles and pages or installed a different theme, let's generate the static site so it can be served by GitHub Pages (or Firebase, Netlify, etc).</p><p>First, if you're using macOS like me, let's install <code>wget</code> via Homebrew. It's like the <code>apt-get</code> of macOS. If you use Linux you should have it already installed.</p><pre><code class="language-bash">brew install wget
</code></pre>
<p>And then to the final part, the bash script. I saved it at the root directory of the blog, and called it <code>generate.sh</code>:</p><pre><code class="language-bash">#!/bin/bash

# Copy blog content
wget --recursive --no-host-directories --directory-prefix=static --adjust-extension --timeout=30 --no-parent --convert-links https://fdezromero.com/

# Copy 404 page
wget --no-host-directories --directory-prefix=static --adjust-extension --timeout=30 --no-parent --convert-links --content-on-error --timestamping https://fdezromero.com/404.html

# Copy sitemaps
wget --recursive --no-host-directories --directory-prefix=static --adjust-extension --timeout=30 --no-parent --convert-links https://fdezromero.com/sitemap.xsl
wget --recursive --no-host-directories --directory-prefix=static --adjust-extension --timeout=30 --no-parent --convert-links https://fdezromero.com/sitemap.xml
wget --recursive --no-host-directories --directory-prefix=static --adjust-extension --timeout=30 --no-parent --convert-links https://fdezromero.com/sitemap-pages.xml
wget --recursive --no-host-directories --directory-prefix=static --adjust-extension --timeout=30 --no-parent --convert-links https://fdezromero.com/sitemap-posts.xml
wget --recursive --no-host-directories --directory-prefix=static --adjust-extension --timeout=30 --no-parent --convert-links https://fdezromero.com/sitemap-authors.xml
wget --recursive --no-host-directories --directory-prefix=static --adjust-extension --timeout=30 --no-parent --convert-links https://fdezromero.com/sitemap-tags.xml

# Replace localhost with domain
LC_ALL=C find ./static -type f -not -wholename *.git* -exec sed -i '' -e 's/http:\/\/fdezromero.com/https:\/\/fdezromero.com/g' {} +
LC_ALL=C find ./static -type f -not -wholename *.git* -exec sed -i '' -e 's/fdezromero.com/fdezromero.com/g' {} +
LC_ALL=C find ./static -type f -not -wholename *.git* -exec sed -i '' -e 's/http:\/\/www.gravatar.com/https:\/\/www.gravatar.com/g' {} +

# Set up Github Pages CNAME
echo &quot;fdezromero.com&quot; &gt; static/CNAME
</code></pre>
<p>In order to adapt it to your blog, replace all the occurrences of <code>fdezromero.com</code> with your port number if different, and <code>fdezromero.com</code> with your own domain or subdomain. You can also use the subdomain provided by GitHub Pages, like <code>username.github.io</code>.</p><p>Notice that all the script does is to start crawling all links from the home page and converting them to relative when possible. Then the same with the sitemaps for better SEO. At the end, it replaces any broken link still pointing to the local installation and creates the <code>CNAME</code> file needed by GitHub Pages to use your own custom domain.</p><p>Once we have the script configured, we just need to give it execution permissions and run it:</p><pre><code class="language-bash">chmod +x generate.sh
./generate.sh
</code></pre>
<p>If the blog is up, the script will scrape its contents and you'll have a static copy of your blog in the <code>static</code> directory. From here, you can initialize a git repo and push the site to GitHub:</p><pre><code class="language-bash">cd static
git init
git remote add origin https://github.com/user/repo.git
git push master origin
</code></pre>
<p>And finish configuring your custom domain or subdomain to point to your blog <a href="https://help.github.com/articles/quick-start-setting-up-a-custom-domain/">with this guide</a>.</p>]]></content:encoded></item><item><title><![CDATA[Tips & Tricks for Ionic on Desktop]]></title><description><![CDATA[In the process of customizing Savelist for larger screens, we collected some tips & tricks that we wanted to share that could help you adapt your app for the desktop, without compromising the mobile experience we already had.]]></description><link>https://fdezromero.com/tips-and-tricks-for-ionic-on-desktop/</link><guid isPermaLink="false">5bf44b2b00458904fdb03c87</guid><category><![CDATA[Ionic]]></category><dc:creator><![CDATA[Rodrigo Fern√°ndez]]></dc:creator><pubDate>Thu, 15 Feb 2018 11:00:00 GMT</pubDate><media:content url="https://fdezromero.com/content/images/2018/11/desktop-trick-img.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://fdezromero.com/content/images/2018/11/desktop-trick-img.jpg" alt="Tips & Tricks for Ionic on Desktop"><p><em>Originally published in <a href="https://blog.ionicframework.com/tips-tricks-for-ionic-on-desktop/">The Official Ionic Blog</a>.</em></p><p>We have been using Ionic at <a href="http://savelist.co/" rel="noopener">Savelist</a> since the first alpha versions, and always thought that one of its strongest benefits is the ability to code an app for iOS, Android and the Web with a single codebase. Heck, we even use Ionic to build our browser extensions!</p><p>When we went through the process of launching the Savelist Progressive Web App in January (2017), we noticed that even though it looked as expected on mobile ‚Äì as we started with a ‚Äúmobile first‚Äù approach ‚Äì it didn‚Äôt look quite right on the larger displays of laptops and desktops. Navigation bars and content were too wide and since most content was aligned to the left, there was too much white space on the right of almost all our screens. It felt more like the maximized version of our Android app than a website.</p><p>In the process of customizing Savelist for larger screens, we collected some tips &amp; tricks that we wanted to share that could help you adapt your app for the desktop, without compromising the mobile experience we already had.</p><p>This guide is based on the latest release of <code>ionic-angular</code> at the time (3.9.2). If you‚Äôre using an older version of Ionic, I strongly recommend you to update to the latest release.</p><h3 id="setting-up-the-fixed-grid">Setting up the fixed grid</h3><p>Ionic has a great grid system based on flexbox that we can use to adapt content and make it responsive. It‚Äôs incredibly customizable, and we can define custom grid widths and breakpoints for every resolution.</p><p>First, we limited the grid width in order to make the content easier to navigate. For our needs, all we had to do was removed the <code>xl</code> breakpoint. Ionic handles this without any issues.</p><p>In our <code>src/theme/variables.scss</code>:</p><pre><code class="language-scss">$grid-breakpoints: (
 xs: 0, // Phone (0px - 575px)
 sm: 576px, // Phablet (576px - 767px)
 md: 768px, // Tablet vertical (768px - 991px)
 lg: 992px // Tablet horizontal, Desktop (992px and above)
);
</code></pre>
<p>Next we modified the <code>$grid-max-widths</code> variable and made our app use 100% of the width until it reaches 992px:</p><pre><code class="language-scss">$grid-max-widths: (
 lg: 992px
);
</code></pre>
<p>You could use any other size you‚Äôd want for this, as long as the value <code>lg</code>from <code>$grid-breakpoints</code> matches.</p><h3 id="using-the-fixed-grid-on-pages">Using the fixed grid on pages</h3><p>In order to apply a max-width to our pages, we just wrap the markup inside <code>&lt;ion-content&gt;</code> with <code>&lt;ion-grid fixed&gt;</code>. The <code>fixed</code> attribute tells Ionic‚Äôs grid to use the max-width corresponding to the current breakpoint, or 100% if not defined.</p><p>So this code:</p><pre><code class="language-html">&lt;ion-content&gt;
 &lt;!-- Some code --&gt;
&lt;/ion-content&gt;
</code></pre>
<p>Becomes:</p><pre><code class="language-html">&lt;ion-content&gt;
 &lt;ion-grid fixed&gt;
   &lt;!-- Some code --&gt;
 &lt;/ion-grid&gt;
&lt;/ion-content&gt;
</code></pre>
<p>We don‚Äôt need to apply this to pages that are displayed inside modals or popovers, as they already have a fixed width.</p><h3 id="horizontally-center-the-header-footer-toolbars">Horizontally center the header &amp; footer toolbars</h3><p>We have better looking pages now, but the toolbars inside <code>&lt;ion-header&gt;</code> and <code>&lt;ion-footer&gt;</code> are not horizontally aligned. We can easily adjust them to match of our fixed-width pages by adding these rules at the end of <code>app.scss</code>:</p><pre><code class="language-scss">// Desktop

ion-header .toolbar {
 margin: auto;
}

@media (min-width: map-get($grid-breakpoints, lg)) {
 ion-navbar.toolbar,
 ion-header .toolbar[fixed],
 ion-footer .toolbar[fixed],
 ion-tabs .tabbar {
   margin: 0;
   padding-right: calc((100% - #{map-get($grid-max-widths, lg)}) / 2);
   padding-left: calc((100% - #{map-get($grid-max-widths, lg)}) / 2);
 }
}
</code></pre>
<p>If there is any <code>&lt;ion-toolbar&gt;</code> inside <code>&lt;ion-header&gt;</code> or <code>&lt;ion-footer&gt;</code>, you may want to add the <code>fixed</code> attribute to center them, like <code>&lt;ion-toolbar fixed&gt;</code>.</p><h3 id="showing-tabs-at-the-top">Showing tabs at the top</h3><p>While users are used to having tabs at the bottom in mobile apps, desktop webs usually show them at the top for better usability and navigation. Well known apps like Twitter, Pinterest and Instagram all use tabs at the top for their desktop experience.</p><p>Fortunately, Ionic Framework allows us to easily customize the position and layout of the tabs, so we can have bottom tabs with icons on top in our mobile experience:</p><figure class="kg-card kg-image-card"><img src="https://fdezromero.com/content/images/2018/11/image.png" class="kg-image" alt="Tips & Tricks for Ionic on Desktop"></figure><p>And top tabs with icons on the left for our desktop experience:</p><figure class="kg-card kg-image-card"><img src="https://fdezromero.com/content/images/2018/11/image-1.png" class="kg-image" alt="Tips & Tricks for Ionic on Desktop"></figure><p>To achieve this we can bind class properties to the <code>tabsPlacement</code> and <code>tabsLayout</code> attributes of our <code>&lt;ion-tabs&gt;</code>:</p><pre><code class="language-html">&lt;ion-tabs [tabsPlacement]=&quot;tabsPlacement&quot; [tabsLayout]=&quot;tabsLayout&quot;&gt;
    &lt;!-- Tabs here --&gt;
&lt;ion-tabs&gt;
</code></pre>
<p>And set the values depending on the platform:</p><pre><code class="language-ts">@Component({
  templateUrl: 'app.html'
})
export class AppComponent {
  tabsPlacement: string = 'bottom';
  tabsLayout: string = 'icon-top';

  constructor(
    public platform: Platform,
  ) {
    if (!this.platform.is('mobile')) {
      this.tabsPlacement = 'top';
      this.tabsLayout = 'icon-left';
    }
  }
}
</code></pre>
<p>You can check the different placement and layout options in the <a href="https://ionicframework.com/docs/api/components/tabs/Tabs/">Tabs docs</a>.</p><h3 id="using-the-responsive-grid-and-breakpoints">Using the responsive grid and breakpoints</h3><p>One of Savelist‚Äôs key features is the ability to show all the products you have saved from the web in a clear and organized layout, so cards in a responsive grid was the best way to go in displaying that information.</p><p>This option lets you have one or two cards per row on mobile, and more cards as the screen gets bigger. Cards don‚Äôt have a fixed width and make the best use of the available space.</p><figure class="kg-card kg-image-card"><img src="https://fdezromero.com/content/images/2018/11/image-2.png" class="kg-image" alt="Tips & Tricks for Ionic on Desktop"><figcaption>Mobile</figcaption></figure><figure class="kg-card kg-image-card"><img src="https://fdezromero.com/content/images/2018/11/image-3.png" class="kg-image" alt="Tips & Tricks for Ionic on Desktop"><figcaption>Tablet</figcaption></figure><figure class="kg-card kg-image-card"><img src="https://fdezromero.com/content/images/2018/11/image-4.png" class="kg-image" alt="Tips & Tricks for Ionic on Desktop"><figcaption>Desktop</figcaption></figure><p>It‚Äôs easy to achieve this layout with the help of the grid breakpoints we set up before and <code>col-{breakpoint}-{#}</code>:</p><pre><code class="language-html">&lt;ion-grid fixed&gt;
 &lt;ion-row&gt;
   &lt;ion-card ion-col *ngFor=&quot;let product of products&quot; col-6 col-md-4 col-lg-3&gt;&lt;/ion-card&gt;
 &lt;/ion-row&gt;
&lt;/ion-grid&gt;
</code></pre>
<p>Rows will start with 2 cards on <code>xs</code> and <code>sm</code>, 3 cards on <code>md</code> and 4 cards on <code>lg</code> and above.</p><h3 id="adapting-the-experience">Adapting the experience</h3><p>We have addressed the biggest points of adapting the PWA ‚Äúapp shell‚Äù to big screens. However, you may still notice some items that you want to show differently, like font size, images, UI, etc.</p><p>There is no silver bullet for this, but you can achieve almost anything you want starting with this media query, so if you ever change the <code>lg</code> breakpoint the media query will update as well:</p><pre><code class="language-scss">@media (min-width: map-get($grid-breakpoints, lg)) {
 // Your rules here
}
</code></pre>
<p>Another way is to show or hide elements according to the platform type instead of the screen size with <code>showWhen</code> and <code>hideWhen</code>. You can use the value <code>core</code> to target desktops.</p><hr><h3 id="share-your-tricks-">Share your tricks!</h3><p>This was just a few of the changes we made to Savelist in order to look better on larger screens, but I‚Äôm sure there‚Äôs more ideas out there. I‚Äôd love to know what tricks you have in your bag with working with Ionic, so leave a comment below!</p>]]></content:encoded></item><item><title><![CDATA[Injecting Providers into Async Custom Validators in Angular]]></title><description><![CDATA[One of the first things developers do when we are building a new app is a signup form, that checks that every field is okay and shows an appropriate error message if it‚Äôs not.]]></description><link>https://fdezromero.com/injecting-providers-into-async-custom-validators-in-angular/</link><guid isPermaLink="false">5bf1fb12e38f017290dd07aa</guid><category><![CDATA[Angular]]></category><category><![CDATA[Ionic]]></category><dc:creator><![CDATA[Rodrigo Fern√°ndez]]></dc:creator><pubDate>Thu, 09 Feb 2017 11:00:00 GMT</pubDate><media:content url="https://fdezromero.com/content/images/2018/11/jantine-doornbos-398339-unsplash.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://fdezromero.com/content/images/2018/11/jantine-doornbos-398339-unsplash.jpg" alt="Injecting Providers into Async Custom Validators in Angular"><p>One of the first things developers do when we are building a new app is a signup form, that checks that every field is okay and shows an appropriate error message if it‚Äôs not.</p><p>It‚Äôs also a common practice to check if the typed email is already registered or if the username is taken. Angular has some basic validators built in, but in order to check our API and return the status we need to write a custom async validator. Please read this great guide about <a href="https://www.joshmorony.com/advanced-forms-validation-in-ionic-2/" rel="noopener">Advanced Forms &amp; Validation in Ionic 2</a> by Josh Morony first.</p><p>The only part missing in the guide is to actually inject the provider in charge of connecting to our API and getting the result. This is a bit tricky since <strong>async validators need to have static properties and we can‚Äôt inject a provider directly</strong>, so we will have to pass it to the validator class by using its constructor. This will work from Angular 2 onwards, I‚Äôm using Ionic 2.</p><p>Here is how I solved it. If you know any way to improve this code, please leave a comment with a link to your code!</p><pre><code class="language-ts">import { FormControl } from '@angular/forms';
import { UserService } from '../../providers/user-service/user-service';

export class UserValidator {
  static userService: UserService;
  static EMAIL_REGEXP = /.+@.+\..+/;

  constructor(userService: UserService) {
    UserValidator.userService = userService;
  }

  // Async validator: `new UserValidator(userService).checkEmailAvailable`

  checkEmailAvailable(input: FormControl) {
    if (!input.value || !UserValidator.EMAIL_REGEXP.test(input.value)) {
      return Promise.resolve({ invalid: true });
    }

    return UserValidator.userService.checkEmail(input.value)
    .then(data =&gt; data &amp;&amp; data.available ? null : data)
    .catch(err =&gt; console.error(err));
  }
}
</code></pre>
<p>We start making our class properties static, then we inject the provider UserService into the constructor. Because we have defined <code>userService</code> as static, we can assign the reference to the provider by using the Class.property syntax.</p><p>The validator function is actually very simple: it returns <code>null</code> if there aren‚Äôt any errors, or an object with every error set to true. My API actually returns <code>{ available: true }</code> if everything is okay and then I convert that to null, but you may handle this differently.</p><p>Now every time we want to use this validator, we need to call it from our parent class like <code>new UserValidator(userService).checkEmailAvailable</code> .</p><p>With this snippet, it would be fairly simple to create another validator function inside the <code>UserValidator</code> class to check if a username is taken or not.</p>]]></content:encoded></item><item><title><![CDATA[How To Connect Virtual Networks through a VPN in the New Azure Portal (Resource Manager)]]></title><description><![CDATA[This article covers a very common use case for startups using Microsoft Azure and BizSpark: how to connect virtual machines from two virtual networks in different subscriptions (or regions) with the new Azure Portal (Resource Manager or ARM).]]></description><link>https://fdezromero.com/how-to-connect-virtual-networks-through-a-vpn-in-the-new-azure-portal-resource-manager/</link><guid isPermaLink="false">5bf1d4f63511de70fc804a35</guid><category><![CDATA[Azure]]></category><category><![CDATA[Startups]]></category><dc:creator><![CDATA[Rodrigo Fern√°ndez]]></dc:creator><pubDate>Fri, 01 Apr 2016 10:00:00 GMT</pubDate><media:content url="https://fdezromero.com/content/images/2018/11/1_KXZKF9RkS1Tdr0yYFGcY6Q.jpg" medium="image"/><content:encoded><![CDATA[<img src="https://fdezromero.com/content/images/2018/11/1_KXZKF9RkS1Tdr0yYFGcY6Q.jpg" alt="How To Connect Virtual Networks through a VPN in the New Azure Portal (Resource Manager)"><p>This article covers a very common use case for startups using Microsoft Azure and BizSpark: how to connect virtual machines from two virtual networks in different subscriptions (or regions) with the new Azure Portal (Resource Manager or ARM).</p><p>The BizSpark program gives startups like <a href="https://savelist.co/?utm_source=engineering_blog" rel="noopener">Savelist</a> free Azure credits for up to 3 years. The catch is that these credits are divided in several subscriptions with $150/‚Ç¨130 each (one per team member). In order to get the most out of the BizSpark credits, you‚Äôll want to use more than one subscription, but all the resources you create are bound to that subscription. The <em>easiest</em> (note I didn‚Äôt write <em>easy</em>) way is to connect the virtual networks through a VPN at the infrastructure level, using what Azure calls <strong><strong>Virtual Network Gateways</strong></strong>.</p><h4 id="so-to-be-clear-this-article-supposes-that-">So to be clear, this article supposes that:</h4><ul><li>Your VMs and virtual networks were created in the <strong><strong>new Azure Portal</strong></strong>(<strong><strong>Resource Manager</strong></strong> mode or ARM), not the old Classic Portal (Service Manager mode or ASM) .</li><li>These VMs are in <strong><strong>different virtual networks</strong></strong>. It doesn‚Äôt matter if they are in the same subscription, in other subscription or in another Azure location. We‚Äôll connect them with a secure VPN that will route the traffic over the Internet (but inside the Azure backbone). If they are in the same virtual network, the VMs will just see each other and you don‚Äôt need any of this.</li><li>You want to use the <strong><strong>Azure Portal</strong></strong> instead of the Azure CLI or PowerShell. Because we are cool dev hipsters, not SysAdmins from the 90s (although the Azure CLI is wrote in NodeJS and that‚Äôs also cool).</li></ul><hr><h4 id="requirements">Requirements</h4><p>Before we can connect the virtual networks, there are some requirements and considerations:</p><ul><li>The <strong><strong>address spaces</strong></strong> of the virtual networks <strong><strong>cannot collide</strong></strong>. If they did, when a VM wanted to connect to a local IP, the virtual network wouldn‚Äôt know how to route this request.</li><li>We will need to <strong><strong>create two Virtual Network Gateways</strong></strong>, one for each network. These cost around $27/‚Ç¨23 a piece (in March 2016).</li><li>You may also have to pay for <strong><strong>outbound data traffic sent between the networks</strong></strong> if they are in different regions or outside of Azure, as the VPN connection will be established using public IPs, and therefore routed through the Internet. You won‚Äôt be charged twice, as inbound traffic is always free.</li></ul><h4 id="deployment-overview">Deployment Overview</h4><p>These are all the resources we will use. I‚Äôll be using the letters <strong><strong>a</strong></strong> and <strong><strong>b</strong></strong> to refer to each side of the connection. You can name them whatever you want but I recommend writing your equivalent in a cheat sheet:</p><ul><li>2 existing Virtual Networks: <strong><strong>network-a</strong></strong> and <strong><strong>network-b</strong></strong>.</li><li>2 or more existing Subnets: <strong><strong>subnet-a</strong></strong> and <strong><strong>subnet-b</strong></strong>, inside <em>network-a</em> and <em>network-b</em>, respectively.</li><li>2 new Virtual Network Gateways: <strong><strong>vpn-gateway-a</strong></strong> and <strong><strong>vpn-gateway-b</strong></strong>.</li><li>2 new Public IP addresses for the Virtual Network Gateways: <strong><strong>vpn-ip-a</strong></strong> and <strong><strong>vpn-ip-b</strong></strong>.</li><li>2 new Local Network Gateways: <strong><strong>local-gateway-a</strong></strong> and <strong><strong>local-gateway-b</strong></strong>.</li><li>2 new Connections: <strong><strong>vpn-connection-a</strong></strong> and <strong><strong>vpn-connection-b</strong></strong>.</li></ul><p>In the example I will be also considering that you have 2 different subscriptions, resource groups and locations.</p><blockquote>If you have your virtual networks under the same subscription, resource group or location it‚Äôs okay, just consider that the following are the same in your case.</blockquote><ul><li>iptions: <strong><strong>subscription-a</strong></strong> and <strong><strong>subscription-b</strong></strong> (can be the same).</li><li>2 Resource Groups: <strong><strong>resource-group-a</strong></strong> and <strong><strong>resource-group-b</strong></strong> (can be the same).</li><li>2 Locations: <strong><strong>location-a</strong></strong> and <strong><strong>location-b</strong></strong> (can be the same).</li></ul><h4 id="network-specs">Network Specs</h4><p>These are the specs of the two networks. Notice that the IP address spaces are different, so they don‚Äôt collide. If they do now, you will have to change the address space in one of them before you continue.</p><pre><code>network-a
  Address space: 10.0.0.0/16
  Subnets:
    subnet-a: 10.0.0.0/24
network-b
  Address space: 10.1.0.0/16
  Subnets:
    subnet-b: 10.1.0.0/24
</code></pre>
<h3 id="1-create-the-gateway-subnets">1. Create the Gateway Subnets</h3><p>The Virtual Network Gateways that we will create in the next step need that the networks have a special subnet inside exactly named <strong><strong>GatewaySubnet</strong></strong>. If you already have them just skip this step.</p><p>Go to <em>Virtual networks &gt; Settings &gt; Subnets</em> and click the add Gateway subnet button. Choose an address space inside <strong><strong>network-a</strong></strong> that is bigger or equal to /29 and that doesn‚Äôt collide with the other subnets. For simplicity, I‚Äôm using /24. Repeat the steps with <strong><strong>network-b</strong></strong> so you end up with something like this:</p><pre><code>network-a
  Address space: 10.0.0.0/16
  Subnets:
    subnet-a: 10.0.0.0/24
    GatewaySubnet: 10.0.1.0/24
network-b
  Address space: 10.1.0.0/16
  Subnets:
    subnet-b: 10.1.0.0/24
    GatewaySubnet: 10.1.1.0/24
</code></pre>
<h3 id="2-create-the-virtual-network-gateways">2. Create the Virtual Network Gateways</h3><p>Go to <em>Virtual network gateways &gt; Add</em> and select the following:</p><pre><code>Name: vpn-gateway-a
Virtual network: network-a
Public IP address: vpn-ip-a (new)
Gateway type: VPN
VPN type: Route-based
Subscription: subscription-a
Resource group: resource-group-a
Location: location-a
</code></pre>
<p>Repeat the steps for the other subscription/network:</p><pre><code>Name: vpn-gateway-b
Virtual network: network-b
Public IP address: vpn-ip-b (new)
Gateway type: VPN
VPN type: Route-based
Subscription: subscription-b
Resource group: resource-group-b
Location: location-b
</code></pre>
<p>The deploy can take up to 45 minutes, but we can set some other things up meanwhile.</p><h3 id="3-find-the-ip-addresses">3. Find the IP addresses</h3><p>When the deploy of the previous step starts, you will have 2 new public IP addresses, <strong><strong>vpn-ip-a</strong></strong> and <strong><strong>vpn-ip-b</strong></strong>. It‚Äôs okay if the Virtual Network gateways are still deploying because the IPs are created at the beginning. If there aren‚Äôt there just wait a couple of minutes and refresh the list.</p><p>Go to <em>Public IP addresses, </em>select <strong><strong>vpn-ip-a</strong></strong> and write down its number because we will need it later on. Do the same for <strong><strong>vpn-ip-b</strong></strong>. Let‚Äôs say these are my public IPs (yours will be different):</p><pre><code>vpn-ip-a: 40.84.0.1
vpn-ip-b: 40.84.0.2
</code></pre>
<h3 id="4-create-the-local-network-gateways">4. Create the Local Network Gateways</h3><p>This is the tricky part that took me a couple of hours to figure out. In each side of the VPN, we have a virtual network with a virtual gateway (probably still deploying) that acts as a door to the outside Internet that sends and receives traffic to the other end. But we need something to tell our virtual network ‚Äúhey, for these local IP address outside your address space, you will have to get them through the door at 40.84.0.X‚Äù.</p><p>So <strong><strong>network-a</strong></strong> needs to know that the 10.1.0.0/16 range, that is outside its address space (10.0.0.0/16), is reachable through <strong><strong>vpn-ip-b</strong></strong> (40.84.0.2). And <strong><strong>network-b</strong></strong> (10.1.0.0/16) needs to know that the outside space 10.0.0.0/16 is reachable through <strong><strong>vpn-ip-a</strong></strong> (40.84.0.1). This something is a <strong><strong>Local Network Gateway</strong></strong>.</p><p>Go to <em>Local network gateways &gt; Add</em> and create one for <strong><strong>network-a</strong></strong>:</p><pre><code>Name: local-gateway-b
IP address: 40.84.0.2 (vpn-ip-b)
Address space: 10.1.0.0/16
Subscription: subscription-a
Resource group: resource-group-a
Location: location-a
</code></pre>
<p>See what happened here? We created the <strong><strong>local-gateway-b</strong></strong> in the same subscription and resource group as <strong><strong>network-a</strong></strong>, with the public IP and address space of <strong><strong>network-b</strong></strong>. This is how <strong><strong>network-a</strong></strong> knows how to get to an IP from <strong><strong>network-b</strong></strong>.</p><p>Let‚Äôs now create the one for <strong><strong>network-b</strong></strong>:</p><pre><code>Name: local-gateway-a
IP address: 40.84.0.1 (vpn-ip-a)
Address space: 10.0.0.0/16
Subscription: subscription-b
Resource group: resource-group-b
Location: location-b
</code></pre>
<h3 id="5-create-the-connections">5. Create the Connections</h3><blockquote>From this point forward you need both Virtual Network Gateways to have finished deploying. If they haven‚Äôt, just chill out <a href="https://savelist.co/?utm_source=engineering_blog" rel="noopener">or have a look at what we do at Savelist</a>.</blockquote><p>With the Virtual Network Gateways deployed, we now need to create a connection between <strong><strong>local-gateway-b</strong></strong> and <strong><strong>vpn-gateway-a</strong></strong> (for <em>network-a</em>) and another between <strong><strong>local-gateway-a</strong></strong> and <strong><strong>vpn-gateway-b</strong></strong> (for <em>network-b</em>). This will complete the traffic routing.</p><pre><code>   network-a
local-gateway-b
 vpn-gateway-a
      ||
   Internet
      ||
 vpn-network-b
local-gateway-a
  network-b
</code></pre>
<p>Go to <em>Local network gateways</em> in <strong><strong>subscription-a</strong></strong> and select <strong><strong>local-gateway-b</strong></strong>and then<strong><strong> </strong></strong><em>Settings &gt; Connections &gt; Add</em>. The <em>Connection type</em> will already have <em>Site-to-site (IPsec)</em> selected and greyed out.</p><p>You can choose any mix of letters and numbers as your shared key (PSK), as long as you put the same in both <strong><strong>vpn-connection-a</strong></strong> and <strong><strong>vpn-connection-b</strong></strong>. It acts as a password to secure the connection.</p><blockquote>Pro tip: <a href="https://www.grc.com/passwords.htm" rel="noopener">The GRC site generates ultra secure passwords just for you through HTTPS</a>. I copied and pasted the one in the 3rd box.</blockquote><pre><code>Name: vpn-connection-b
Connection type: Site-to-site (IPsec)
Virtual network gateway: vpn-gateway-a
Local network gateway: local-gateway-b (locked)
Shared key (PSK): (choose a mix of letters and numbers)
Subscription: subscription-a
Location: location-a
</code></pre>
<p>Repeat the process for <strong><strong>local-gateway-a</strong></strong> in <strong><strong>subscription-b</strong></strong>:</p><pre><code>Name: vpn-connection-a
Connection type: Site-to-site (IPsec)
Virtual network gateway: vpn-gateway-b
Local network gateway: local-gateway-a (locked)
Shared key (PSK): (paste the same key as before)
Subscription: subscription-b
Location: location-b
</code></pre>
<p>If everything went well, after a few minutes the Virtual Networks Gateways will establish a connection and show with the <em>Connected</em> status. If it doesn‚Äôt work after 10 minutes, check that the IPs and address spaces in the Local Network Gateways are correct and from the <strong><strong>other</strong></strong> network.</p><h3 id="6-test-the-connection">6. Test the Connection</h3><p>You can just now log into a machine in <strong><strong>network-a</strong></strong> and try to access a machine in <strong><strong>network-b</strong></strong>, and viceversa. You will see the traffic increase in the connection details. If it doesn‚Äôt work, check the network security groups used by your virtual machines and/or virtual networks. If the VPN connection shows <em>Connected</em>, then is working fine and something else in your networks is blocking the communication.</p><hr><blockquote>Special thanks to <a href="https://twitter.com/DevStarlight" rel="noopener">Jes√∫s Huerta</a>, who helped me translate the old and confusing articles from Microsoft to the newer Azure Portal and ARM.</blockquote>]]></content:encoded></item></channel></rss>
