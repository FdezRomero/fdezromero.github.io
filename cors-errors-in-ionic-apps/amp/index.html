<!DOCTYPE html>
<html ⚡>
<head>
    <meta charset="utf-8">

    <title>CORS Errors in Ionic Apps</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <link rel="shortcut icon" href="../../favicon.png" type="image/png" />
    <link rel="canonical" href="../" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    
    <meta property="og:site_name" content="Rodrigo Fernández" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="CORS Errors in Ionic Apps" />
    <meta property="og:description" content="CORS errors are common in web apps when a cross-origin request is made but the server doesn&#x27;t return the required headers in the response. Learn how to fix them in this article." />
    <meta property="og:url" content="https://fdezromero.com/cors-errors-in-ionic-apps/" />
    <meta property="og:image" content="https://fdezromero.com/content/images/2019/02/cors-error.png" />
    <meta property="article:published_time" content="2019-02-05T17:30:00.000Z" />
    <meta property="article:modified_time" content="2019-02-06T13:57:10.000Z" />
    <meta property="article:tag" content="Ionic" />
    <meta property="article:tag" content="Web" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="CORS Errors in Ionic Apps" />
    <meta name="twitter:description" content="CORS errors are common in web apps when a cross-origin request is made but the server doesn&#x27;t return the required headers in the response. Learn how to fix them in this article." />
    <meta name="twitter:url" content="https://fdezromero.com/cors-errors-in-ionic-apps/" />
    <meta name="twitter:image" content="https://fdezromero.com/content/images/2019/02/cors-error.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Rodrigo Fernández" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="Ionic, Web" />
    <meta name="twitter:site" content="@FdezRomero" />
    <meta name="twitter:creator" content="@FdezRomero" />
    <meta property="og:image:width" content="1600" />
    <meta property="og:image:height" content="420" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Rodrigo Fernández",
        "logo": "https://fdezromero.com/content/images/2018/11/publication-logo.png"
    },
    "author": {
        "@type": "Person",
        "name": "Rodrigo Fernández",
        "image": {
            "@type": "ImageObject",
            "url": "//www.gravatar.com/avatar/3f5e2c1bb78a56f68f8c04ee09acccac?s=250&d=mm&r=x",
            "width": 250,
            "height": 250
        },
        "url": "https://fdezromero.com/author/rodrigo/",
        "sameAs": [
            "https://fdezromero.com",
            "https://twitter.com/FdezRomero"
        ]
    },
    "headline": "CORS Errors in Ionic Apps",
    "url": "https://fdezromero.com/cors-errors-in-ionic-apps/",
    "datePublished": "2019-02-05T17:30:00.000Z",
    "dateModified": "2019-02-06T13:57:10.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://fdezromero.com/content/images/2019/02/cors-error.png",
        "width": 1600,
        "height": 420
    },
    "keywords": "Ionic, Web",
    "description": "CORS errors are common in web apps when a cross-origin request is made but the server doesn&#x27;t return the required headers in the response. Learn how to fix them in this article.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://fdezromero.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 2.12" />
    <link rel="alternate" type="application/rss+xml" title="Rodrigo Fernández" href="../../rss/" />

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,600,400" />
    <style amp-custom>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{margin:0.67em 0;font-size:2em}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{position:relative;vertical-align:baseline;font-size:75%;line-height:0}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}amp-img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace, monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em;border:1px solid #c0c0c0}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{max-height:100%;height:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0, 0, 0, 0)}body{max-height:100%;height:100%;color:#3a4145;background:#f4f8fb;letter-spacing:0.01rem;font-family:"Merriweather", serif;font-size:1.8rem;line-height:1.75em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{margin:0 0 0.3em 0;color:#2e2e2e;font-family:"Open Sans", sans-serif;line-height:1.15em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-moz-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1;-o-font-feature-settings:"dlig" 1, "liga" 1, "lnum" 1, "kern" 1}h1{text-indent:-2px;letter-spacing:-1px;font-size:2.6rem}h2{letter-spacing:0;font-size:2.4rem}h3{letter-spacing:-0.6px;font-size:2.1rem}h4{font-size:1.9rem}h5{font-size:1.8rem}h6{font-size:1.8rem}a{color:#4a4a4a}a:hover{color:#111}p,ul,ol,dl{margin:0 0 2.5rem 0;font-size:1.5rem;text-rendering:geometricPrecision;-webkit-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-moz-font-feature-settings:"liga" 1, "onum" 1, "kern" 1;-o-font-feature-settings:"liga" 1, "onum" 1, "kern" 1}ol,ul{padding-left:2em}ol ol,ul ul,ul ol,ol ul{margin:0 0 0.4em 0;padding-left:2em}dl dt{float:left;clear:left;overflow:hidden;margin-bottom:1em;width:180px;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd{margin-bottom:1em;margin-left:200px}li{margin:0.4em 0}li li{margin:0}hr{display:block;margin:1.75em 0;padding:0;height:1px;border:0;border-top:#efefef 1px solid}blockquote{box-sizing:border-box;margin:1.75em 0 1.75em 0;padding:0 0 0 1.75em;border-left:#4a4a4a 0.4em solid;-moz-box-sizing:border-box}blockquote p{margin:0.8em 0;font-style:italic}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;color:#ccc;font-size:0.9em}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:normal}mark{background-color:#fdffb6}code,tt{padding:1px 3px;border:#e3edf3 1px solid;background:#f7fafb;border-radius:2px;white-space:pre-wrap;font-family:Inconsolata, monospace, sans-serif;font-size:0.85em;font-feature-settings:"liga" 0;-webkit-font-feature-settings:"liga" 0;-moz-font-feature-settings:"liga" 0}pre{overflow:auto;box-sizing:border-box;margin:0 0 1.75em 0;padding:10px;width:100%;border:#e3edf3 1px solid;background:#f7fafb;border-radius:3px;white-space:pre;font-family:Inconsolata, monospace, sans-serif;font-size:0.9em;-moz-box-sizing:border-box}pre code,pre tt{padding:0;border:none;background:transparent;white-space:pre-wrap;font-size:inherit}kbd{display:inline-block;margin-bottom:0.4em;padding:1px 8px;border:#ccc 1px solid;background:#f4f4f4;border-radius:4px;box-shadow:0 1px 0 rgba(0, 0, 0, 0.2), 0 1px 0 0 #fff inset;color:#666;text-shadow:#fff 0 1px 0;font-size:0.9em;font-weight:700}table{box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%;background-color:transparent;-moz-box-sizing:border-box}table th,table td{padding:8px;border-top:#efefef 1px solid;vertical-align:top;text-align:left;line-height:20px}table th{color:#000}table caption + thead tr:first-child th,table caption + thead tr:first-child td,table colgroup + thead tr:first-child th,table colgroup + thead tr:first-child td,table thead:first-child tr:first-child th,table thead:first-child tr:first-child td{border-top:0}table tbody + tbody{border-top:#efefef 2px solid}table table table{background-color:#fff}table tbody > tr:nth-child(odd) > td,table tbody > tr:nth-child(odd) > th{background-color:#f6f6f6}table.plain tbody > tr:nth-child(odd) > td,table.plain tbody > tr:nth-child(odd) > th{background:transparent}iframe,amp-iframe,.fluid-width-video-wrapper{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper amp-iframe{margin:0}textarea,select,input{margin:0 0 5px 0;padding:6px 9px;width:260px;outline:0;border:#e7eef2 1px solid;background:#fff;border-radius:4px;box-shadow:none;font-family:"Open Sans", sans-serif;font-size:1.6rem;line-height:1.4em;font-weight:100;-webkit-appearance:none}textarea{min-width:250px;min-height:80px;max-width:340px;width:100%;height:auto}input[type="text"]:focus,input[type="email"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="number"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,textarea:focus{outline:none;outline-width:0;border:#bbc7cc 1px solid;background:#fff}select{width:270px;height:30px;line-height:30px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.main-header{position:relative;display:table;overflow:hidden;box-sizing:border-box;width:100%;height:50px;background:#5ba4e5 no-repeat center center;background-size:cover;text-align:left;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.content{background:#fff;padding-top:15px}.blog-title,.content{margin:auto;max-width:600px}.blog-title a{display:block;padding-right:16px;padding-left:16px;height:50px;color:#fff;text-decoration:none;font-family:"Open Sans", sans-serif;font-size:16px;line-height:50px;font-weight:600}.post{position:relative;margin-top:0;margin-right:16px;margin-left:16px;padding-bottom:0;max-width:100%;border-bottom:#ebf2f6 1px solid;word-wrap:break-word;font-size:0.95em;line-height:1.65em}.post-header{margin-bottom:1rem}.post-title{margin-bottom:0}.post-title a{text-decoration:none}.post-meta{display:block;margin:3px 0 0 0;color:#9eabb3;font-family:"Open Sans", sans-serif;font-size:1.3rem;line-height:2.2rem}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.post-meta .author{margin:0;font-size:1.3rem;line-height:1.3em}.post-date{display:inline-block;text-transform:uppercase;white-space:nowrap;font-size:1.2rem;line-height:1.2em}.post-image{margin:0;padding-top:3rem;padding-bottom:30px;border-top:1px #E8E8E8 solid}.post-content amp-img,.post-content amp-anim{position:relative;left:50%;display:block;padding:0;min-width:0;max-width:112%;width:calc(100% + 32px);height:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}.footnotes{font-size:1.3rem;line-height:1.6em;font-style:italic}.footnotes li{margin:0.6rem 0}.footnotes p{margin:0}.footnotes p a:last-child{text-decoration:none}.site-footer{position:relative;margin:0 auto 20px auto;padding:1rem 15px;max-width:600px;color:rgba(0,0,0,0.5);font-family:"Open Sans", sans-serif;font-size:1.1rem;line-height:1.75em}.site-footer a{color:rgba(0,0,0,0.5);text-decoration:none;font-weight:bold}.site-footer a:hover{border-bottom:#bbc7cc 1px solid}.poweredby{display:block;float:right;width:45%;text-align:right}.copyright{display:block;float:left;width:45%}</style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="../../">Rodrigo Fernández</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">CORS Errors in Ionic Apps</h1>
                <section class="post-meta">
                    <p class="author">by <a href="../../author/rodrigo/">Rodrigo Fernández</a></p>
                    <time class="post-date" datetime="2019-02-05">2019-02-05</time>
                </section>
            </header>
            <figure class="post-image">
                <amp-img src="https://fdezromero.com/content/images/2019/02/cors-error.png" width="600" height="400" layout="responsive"></amp-img>
            </figure>
            <section class="post-content">

                <h2 id="whatiscors">What is CORS?</h2>
<p><strong>Cross-Origin Resource Sharing (CORS)</strong> is a mechanism that browsers and webviews — like the ones powering Capacitor and Cordova — use to restrict HTTP and HTTPS requests made from scripts to resources in a different origin for security reasons, mainly to protect your user's data and prevent attacks that would compromise your app.</p>
<p>In order to know if an external origin supports CORS, the server has to send some <a href="#cors-headers">special headers</a> for the browser to allow the requests.</p>
<p>An <strong>origin</strong> is the combination of the <strong>protocol</strong>, <strong>domain</strong>, and <strong>port</strong> from which your Ionic app or the external resource is served. For example, apps running in Capacitor have <code>capacitor://localhost</code> (iOS) or <code>http://localhost</code> (Android) as their origin.</p>
<p>When the origin where your app is served (e.g. <code>http://localhost:8100</code> with <code>ionic serve</code>) and the origin of the resource being requested (e.g. <code>https://api.example.com</code>) don't match, the browser's <a href="https://developer.mozilla.org/en-US/docs/Web/Security/Same-origin_policy" target="_blank" rel="noopener">Same Origin Policy</a> takes effect and CORS is required for the request to be made.</p>
<p>CORS errors are common in web apps when a cross-origin request is made but the server doesn't return the required headers in the response (is not CORS-enabled):</p>
<blockquote>
  XMLHttpRequest cannot load https://api.example.com. No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:8100' is therefore not allowed access.
</blockquote>
<h2 id="howdoescorswork">How does CORS work</h2>
<h3 id="requestwithpreflight">Request with preflight</h3>
<p>By default, when a web app tries to make a cross-origin request the browser sends a <strong>preflight request</strong> before the actual request. This preflight request is needed in order to know if the external resource supports CORS and if the actual request can be sent safely, since it may impact user data.</p>
<p>A preflight request is sent by the browser if:</p>
<ul>
<li><strong>The method is:</strong>
<ul>
<li>PUT</li>
<li>DELETE</li>
<li>CONNECT</li>
<li>OPTIONS</li>
<li>TRACE</li>
<li>PATCH</li>
</ul>
</li>
<li><strong>Or if it has a header other than:</strong>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Content-Type</li>
<li>DPR</li>
<li>Downlink</li>
<li>Save-Data</li>
<li>Viewport-Width</li>
<li>Width</li>
</ul>
</li>
<li><strong>Or if it has a <code>Content-Type</code> header other than:</strong>
<ul>
<li>application/x-www-form-urlencoded</li>
<li>multipart/form-data</li>
<li>text/plain</li>
</ul>
</li>
<li>Or if a <code>ReadableStream</code> or event listeners in <code>XMLHttpRequestUpload</code> are used.</li>
</ul>
<p>If any of the conditions above are met, a preflight request with the <code>OPTIONS</code> method is sent to the resource URL.</p>
<p>Let's suppose we are making a <code>POST</code> request to a fictional JSON API at <code>https://api.example.com</code> with a <code>Content-Type</code> of <code>application/json</code>. The preflight request would be like this (some default headers omitted for clarity):</p>
<pre><code class="language-http">OPTIONS / HTTP/1.1
Host: api.example.com
Origin: http://localhost:8100
Access-Control-Request-Method: POST
Access-Control-Request-Headers: Content-Type
</code></pre>
<p>If the server is CORS enabled, it will parse the <code>Access-Control-Request-*</code> headers and understand that a <code>POST</code> request is trying to be made from <code>http://localhost:8100</code> with a custom <code>Content-Type</code>.</p>
<p>The server will then respond to this preflight with which origins, methods, and headers are allowed by using the <code>Access-Control-Allow-*</code> headers:</p>
<pre><code class="language-http">HTTP/1.1 200 OK
Access-Control-Allow-Origin: http://localhost:8100
Access-Control-Allow-Methods: GET, POST, OPTIONS
Access-Control-Allow-Headers: Content-Type
</code></pre>
<p>If the returned origin and method don't match the ones from the actual request, or any of the headers used are not allowed, the request will be blocked by the browser and an error will be shown in the console. Otherwise, the request will be made after the preflight.</p>
<p>In our example, since the API expects JSON, all <code>POST</code> requests will have a <code>Content-Type: application/json</code> header and always be preflighted.</p>
<h3 id="simplerequests">Simple requests</h3>
<p>Some requests are always considered safe to send and don't need a preflight if they meet all of the following conditions:</p>
<ul>
<li><strong>The method is:</strong>
<ul>
<li>GET</li>
<li>HEAD</li>
<li>POST</li>
</ul>
</li>
<li><strong>Have only these headers:</strong>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Content-Type</li>
<li>DPR</li>
<li>Downlink</li>
<li>Save-Data</li>
<li>Viewport-Width</li>
<li>Width</li>
</ul>
</li>
<li><strong>The <code>Content-Type</code> header is:</strong>
<ul>
<li>application/x-www-form-urlencoded</li>
<li>multipart/form-data</li>
<li>text/plain</li>
</ul>
</li>
<li>No <code>ReadableStream</code> or event listeners in <code>XMLHttpRequestUpload</code> are used.</li>
</ul>
<p>In our example API, <code>GET</code> requests don't need to be preflighted because no JSON data is being sent, and so the app doesn't need to use the <code>Content-Type: application/json</code> header. They will always be simple requests.</p>
<h2 id="corsheaders">CORS Headers</h2>
<h3 id="serverheadersresponse">Server Headers (Response)</h3>
<table>
<thead>
<tr>
<th>Header</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Access-Control-Allow-Origin</strong></td>
<td><code>origin</code> or <code>*</code></td>
<td>Specifies the origin to be allowed, like <code>http://localhost:8100</code> or <code>*</code> to allow all origins.</td>
</tr>
<tr>
<td><strong>Access-Control-Allow-Methods</strong></td>
<td><code>methods</code></td>
<td>Which methods are allowed when accessing the resource: <code>GET</code>, <code>HEAD</code>, <code>POST</code>, <code>PUT</code>, <code>DELETE</code>, <code>CONNECT</code>, <code>OPTIONS</code>, <code>TRACE</code>, <code>PATCH</code>.</td>
</tr>
<tr>
<td><strong>Access-Control-Allow-Headers</strong></td>
<td><code>headers</code></td>
<td>Used in response to a preflight request to indicate which headers can be used when making the actual request, aside from the <a href="#simple-requests">simple headers</a>, which are always allowed.</td>
</tr>
<tr>
<td>Access-Control-Allow-Credentials</td>
<td><code>true</code> or <code>false</code></td>
<td>Whether or not the request can be made with credentials.</td>
</tr>
<tr>
<td>Access-Control-Expose-Headers</td>
<td><code>headers</code></td>
<td>Whitelists the headers that the browser is allowed to access.</td>
</tr>
<tr>
<td>Access-Control-Max-Age</td>
<td><code>seconds</code></td>
<td>Indicates how long the results of a preflight request can be cached.</td>
</tr>
</tbody>
</table>
<h3 id="browserheadersrequest">Browser Headers (Request)</h3>
<p>The browser automatically sends the appropriate headers for CORS in every request to the server, including the preflight requests. Please note that the headers below are for reference only, and <strong>should not be set in your app code</strong> (the browser will ignore them).</p>
<h4 id="allrequests">All Requests</h4>
<table>
<thead>
<tr>
<th>Header</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Origin</strong></td>
<td><code>origin</code></td>
<td>Indicates the origin of the request.</td>
</tr>
</tbody>
</table>
<h4 id="preflightrequests">Preflight Requests</h4>
<table>
<thead>
<tr>
<th>Header</th>
<th>Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Access-Control-Request-Method</strong></td>
<td><code>method</code></td>
<td>Used to let the server know what method will be used when the actual request is made.</td>
</tr>
<tr>
<td>Access-Control-Request-Headers</td>
<td><code>headers</code></td>
<td>Used to let the server know what non-simple headers will be used when the actual request is made.</td>
</tr>
</tbody>
</table>
<h2 id="solutionsforcorserrors">Solutions for CORS Errors</h2>
<h3 id="aenablingcorsinaserveryoucontrol">A. Enabling CORS in a server you control</h3>
<p>The correct and easiest solution is to enable CORS by returning the <a href="#server-headers-response-">right response headers</a> from the web server or backend and responding to preflight requests, as it allows to keep using <code>XMLHttpRequest</code>, <code>fetch</code>, or abstractions like <code>HttpClient</code> in Angular.</p>
<p>Ionic apps may be run from different origins, but only one origin can be specified in the <code>Access-Control-Allow-Origin</code> header. Therefore we recommend checking the value of the <code>Origin</code> header from the request and reflecting it in the <code>Access-Control-Allow-Origin</code> header in the response.</p>
<p>Please note that all of the <code>Access-Control-Allow-*</code> headers have to be sent from the server, and don't belong in your app code.</p>
<p>Here are some of the origins your Ionic app may be served from:</p>
<h4 id="capacitor">Capacitor</h4>
<table>
<thead>
<tr>
<th>Platform</th>
<th>Origin</th>
</tr>
</thead>
<tbody>
<tr>
<td>iOS</td>
<td><code>capacitor://localhost</code></td>
</tr>
<tr>
<td>Android</td>
<td><code>http://localhost</code></td>
</tr>
</tbody>
</table>
<p>Replace <code>localhost</code> with your own hostname if you have changed the default in the Capacitor config.</p>
<h4 id="ionicwebview3xpluginoncordova">Ionic WebView 3.x plugin on Cordova</h4>
<table>
<thead>
<tr>
<th>Platform</th>
<th>Origin</th>
</tr>
</thead>
<tbody>
<tr>
<td>iOS</td>
<td><code>ionic://localhost</code></td>
</tr>
<tr>
<td>Android</td>
<td><code>http://localhost</code></td>
</tr>
</tbody>
</table>
<p>Replace <code>localhost</code> with your own hostname if you have changed the default in the plugin config.</p>
<h4 id="ionicwebview2xpluginoncordova">Ionic WebView 2.x plugin on Cordova</h4>
<table>
<thead>
<tr>
<th>Platform</th>
<th>Origin</th>
</tr>
</thead>
<tbody>
<tr>
<td>iOS</td>
<td><code>http://localhost:8080</code></td>
</tr>
<tr>
<td>Android</td>
<td><code>http://localhost:8080</code></td>
</tr>
</tbody>
</table>
<p>Replace port <code>8080</code> with your own if you have changed the default in the plugin config.</p>
<h4 id="localdevelopmentinthebrowser">Local development in the browser</h4>
<table>
<thead>
<tr>
<th>Command</th>
<th>Origin</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ionic serve</code></td>
<td><code>http://localhost:8100</code> or <code>http://YOUR_MACHINE_IP:8100</code></td>
</tr>
<tr>
<td><code>npm run start</code> or <code>ng serve</code></td>
<td><code>http://localhost:4200</code> for Ionic Angular apps.</td>
</tr>
</tbody>
</table>
<p>Port numbers can be higher if you are serving multiple apps at the same time.</p>
<br />
<p>Allowing any origin with <code>Access-Control-Allow-Origin: *</code> is guaranteed to work in all scenarios but may have security implications — like some CSRF attacks — depending on how the server controls access to resources and use sessions and cookies.</p>
<p>For more information on how to enable CORS in different web and app servers, please check <a href="https://enable-cors.org" target="_blank" rel="noopener">enable-cors.org</a></p>
<p>CORS can be easily enabled in Express/Connect apps with the <a href="https://github.com/expressjs/cors" target="_blank" rel="noopener">cors</a> middleware:</p>
<pre><code class="language-javascript">const express = require('express');
const cors = require('cors');
const app = express();

const whitelist = [
  'capacitor://localhost',
  'ionic://localhost',
  'http://localhost',
  'http://localhost:8080',
  'http://localhost:8100'
];

// Reflect the origin if it's in the whitelist or not defined (cURL, Postman, etc.)
const corsOptions = {
  origin: (origin, callback) =&gt; {
    if (whitelist.includes(origin) || !origin) {
      callback(null, true);
    } else {
      callback(new Error('Origin not allowed by CORS'));
    }
  }
}

// Enable preflight requests for all routes
app.options('*', cors(corsOptions));

app.get('/', cors(corsOptions), (req, res, next) =&gt; {
  res.json({ message: 'This route is CORS-enabled for a whitelisted origin.' });
})

app.listen(3000, () =&gt; {
  console.log('CORS-enabled web server listening on port 3000');
});
</code></pre>
<h3 id="bworkingaroundcorsinaserveryoucantcontrol">B. Working around CORS in a server you can't control</h3>
<h4 id="dontleakyourkeys">Don't leak your keys!</h4>
<p>If you are trying to connect to a 3rd-party API, first check in its documentation that is safe to use it directly from the app (client-side) and that it won't leak any secret/private keys or credentials, as it's easy to see them in clear text in Javascript code. Many APIs don't support CORS on purpose, in order to force developers to use them in the server and protect important information or keys.</p>
<h4 id="1nativeonlyappsiosandroid">1. Native-only apps (iOS/Android)</h4>
<p>Use the <a href="https://fdezromero.com/docs/native/http/" target="_blank" rel="noopener">HTTP plugin from Ionic Native</a> to make the requests natively from outside the webview. Please note that this plugin doesn't work in the browser, so the development and testing of the app must always be done in a device or simulator going forward.</p>
<p><strong>Usage in Ionic Angular 4</strong></p>
<pre><code class="language-typescript">import { Component } from '@angular/core';
import { HTTP } from '@ionic-native/http/ngx';

@Component({
  selector: 'app-home',
  templateUrl: './home.page.html',
  styleUrls: ['./home.page.scss'],
})
export class HomePage {
  constructor(private http: HTTP) {}

  async getData() {
    try {
      const url = 'https://api.example.com';
      const params = {};
      const headers = {};

      const response = await this.http.get(url, params, headers);

      console.log(response.status);
      console.log(JSON.parse(response.data)); // JSON data returned by server
      console.log(response.headers);

    } catch (error) {
      console.error(error.status);
      console.error(error.error); // Error message as string
      console.error(error.headers);
    }
  }
}
</code></pre>
<h4 id="2nativepwas">2. Native + PWAs</h4>
<p>Send the requests through an HTTP/HTTPS proxy that bypasses them to the external resources and adds the necessary CORS headers to the responses. This proxy must be trusted or under your control, as it will be intercepting most traffic made by the app.</p>
<p>Also, keep in mind that the browser or webview will not receive the original HTTPS certificates but the one being sent from the proxy if it's provided. URLs may need to be rewritten in your code in order to use the proxy.</p>
<p>Check <a href="https://github.com/Rob--W/cors-anywhere/" target="_blank" rel="noopener">cors-anywhere</a> for a Node.js CORS proxy that can be deployed in your own server. Using free hosted CORS proxies in production is not recommended.</p>
<h3 id="cdisablingcorsorbrowserwebsecurity">C. Disabling CORS or browser web security</h3>
<p>Please be aware that CORS exists for a reason (security of user data and to prevent attacks against your app). <strong>It's not possible or advisable to try to disable CORS</strong>.</p>
<p>Older webviews like <code>UIWebView</code> on iOS don't enforce CORS but are deprecated and are very likely to disappear soon. Modern webviews like iOS <code>WKWebView</code> or Android <code>WebView</code> (both used by Capacitor) do enforce CORS and provide huge security and performance improvements.</p>
<p>If you are developing a PWA or testing in the browser, using the <code>--disable-web-security</code> flag in Google Chrome or an extension to disable CORS is a really bad idea. You will be exposed to all kind of attacks, you can't ask your users to take the risk, and your app won't work once in production.</p>
<p><strong>Sources</strong></p>
<ul>
<li><a href="https://fdezromero.com/cors-errors-in-ionic-apps" target="_blank" rel="noopener">CORS Errors in Ionic Apps</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener">MDN</a></li>
</ul>


            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="../../">Rodrigo Fernández</a> &copy; 2019</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
</html>
